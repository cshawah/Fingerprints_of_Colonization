---
title: "Final Project Draft"
author: "Chloe Shawah"
date: "11/18/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)

# Load packages

library(readxl)
library(readr)
library(janitor)
library(tidyverse)
library(sf)

```

```{r Data Readin}

# Read in HDI index data, slice out miscellaneous rows, select 2017 column, rename columns

hdi <- read_xlsx("raw_data/UNDP_HDI.xlsx") %>% 
  slice(190:378) %>% 
  clean_names() %>% 
  select(country_name, x2017)
colnames(hdi) <- c("country", "hdi_val")

# Read in child mortality data, select and rename columns

child_mortality <- read_xls("raw_data/WB_Child_Mortality.xls") %>% 
  slice(4:267) %>% 
  clean_names() %>% 
  select(data_source, x63)
colnames(child_mortality) <- c("country", "cm_val")
  
# Read in GDP data, select and rename columns

gdp <- read_xls("raw_data/WB_GDP.xls") %>% 
  slice(4:267) %>% 
  clean_names() %>% 
  select(data_source, x63)
colnames(gdp) <- c("country", "gdp_val")

# Read in literacy rate data, select and rename columns

literacy <- read_xls("raw_data/WB_literacy.xls") %>% 
  slice(5:268) %>% 
  clean_names() %>% 
  select(data_source, x63)
colnames(literacy) <- c("country", "lit_val")

# Read in colonial history data, select columns

colonial_history <- read_csv("raw_data/ICOW_Colonial_History.csv") %>% 
  clean_names() %>% 
  select(state, name, col_ruler, ind_from, ind_date)

# In colonial history dataset, change ind_date variable, currently a character with a month and date - fix this by dropping the last two characters (the month) and coerce to numeric
  
colonial_history$ind_date <- substr(colonial_history$ind_date,1,nchar(colonial_history$ind_date)-2) %>% as.numeric()

# Add new column that crates factors with names for the last occupying powers based on the country codes

colonial_history <- colonial_history %>% mutate(named_ind_from = ifelse(ind_from == 200, "England", "Other")) %>% 
  mutate(named_ind_from = ifelse(ind_from == 230, "Spain", named_ind_from)) %>% 
  mutate(named_ind_from = ifelse(ind_from == 210, "Netherlands", named_ind_from)) %>% 
  mutate(named_ind_from = ifelse(ind_from == -9, "No Colonizer", named_ind_from)) %>% 
  mutate(named_ind_from = ifelse(ind_from == 220, "France", named_ind_from)) %>% 
  mutate(named_ind_from = ifelse(ind_from == 2, "United States", named_ind_from)) %>% 
  mutate(named_ind_from = ifelse(ind_from == 640, "Turkey", named_ind_from)) %>% 
  mutate(named_ind_from = ifelse(ind_from == 365, "Russia", named_ind_from)) %>% 
  mutate(named_ind_from = ifelse(ind_from == 235, "Portugal", named_ind_from))
  
# Left join the four datasets by name. This loses some countries (namely the US because of the different ways to write the name), I will work on fixing this for the final version of the project

colonial_history <- left_join(colonial_history, gdp, by = c("name" = "country"))
colonial_history <- left_join(colonial_history, child_mortality, by = c("name" = "country"))
colonial_history <- left_join(colonial_history, hdi, by = c("name" = "country"))
colonial_history <- left_join(colonial_history, literacy, by = c("name" = "country"))

# Clean the new merged dataset by rounding and coercing to numeric, save this as an object called "plot_data"

plot_data <- colonial_history %>% 
  mutate(gdp_val = round(as.numeric(gdp_val), 4)) %>% 
  mutate(hdi_val = round(hdi_val, 6)) %>% 
  mutate(cm_val = round(as.numeric(cm_val), 2))

# Write this clean data into the Shiny App directory

write.csv(plot_data, "Final_Project_Draft/plot_data.csv")


```

```{r include = FALSE}

# Drafts of plots

# For GDP plot, need to scale y with log10

gdp_plot <- ggplot(plot_data) +
  geom_point(aes(x = ind_date, y = gdp_val, color = named_ind_from)) +
  scale_y_log10()

hdi_plot <- ggplot(plot_data) +
  geom_point(aes(x = ind_date, y = hdi_val, color = named_ind_from))

cm_plot <- ggplot(plot_data) +
  geom_point(aes(x = ind_date, y = cm_val, color = named_ind_from))

lit_plot <- ggplot(plot_data) +
  geom_point(aes(x = ind_date, y = lit_val, color = named_ind_from))

```

Changes to make for final version:

 - Fix the colors of the points for the occupying countries. It is confusing that the colors switch when the check boxes change.
 - I lost some points when merging by country name. There is no ISO3 code in the colonial history dataset, but perhaps I could manually add one and merge using that to eliminate lost points.
 - In each tab, add another graph that plots the trends for the indicators over time instead of the values for one year against independence year. All ths data is already in the data sets, but I cleaned it out when I selected for year. This will add significantly more content to the project.





